exports.main = (function(e) {
  var t = {};
  function n(a) {
    if (t[a]) return t[a].exports;
    var r = (t[a] = { i: a, l: !1, exports: {} });
    return e[a].call(r.exports, r, r.exports, n), (r.l = !0), r.exports;
  }
  return (
    (n.m = e),
    (n.c = t),
    (n.d = function(e, t, a) {
      n.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: a });
    }),
    (n.r = function(e) {
      "undefined" != typeof Symbol &&
        Symbol.toStringTag &&
        Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }),
        Object.defineProperty(e, "__esModule", { value: !0 });
    }),
    (n.t = function(e, t) {
      if ((1 & t && (e = n(e)), 8 & t)) return e;
      if (4 & t && "object" == typeof e && e && e.__esModule) return e;
      var a = Object.create(null);
      if (
        (n.r(a),
        Object.defineProperty(a, "default", { enumerable: !0, value: e }),
        2 & t && "string" != typeof e)
      )
        for (var r in e)
          n.d(
            a,
            r,
            function(t) {
              return e[t];
            }.bind(null, r)
          );
      return a;
    }),
    (n.n = function(e) {
      var t =
        e && e.__esModule
          ? function() {
              return e.default;
            }
          : function() {
              return e;
            };
      return n.d(t, "a", t), t;
    }),
    (n.o = function(e, t) {
      return Object.prototype.hasOwnProperty.call(e, t);
    }),
    (n.p = ""),
    n((n.s = 7))
  );
})([
  function(e, t, n) {
    "use strict";
    n.d(t, "a", function() {
      return a;
    }),
      n.d(t, "b", function() {
        return r;
      });
    const a = { GET_LOTTERY_FAILED: "GET_LOTTERY_FAILED" },
      r = {
        USER_LOTTERY_RECORD: 81892,
        LOTTERY: 81873,
        ERROR: 83510,
        CONFIG: 83587
      };
  },
  function(e, t, n) {
    "use strict";
    n.d(t, "a", function() {
      return r;
    }),
      n.d(t, "e", function() {
        return o;
      }),
      n.d(t, "d", function() {
        return u;
      }),
      n.d(t, "b", function() {
        return l;
      }),
      n.d(t, "c", function() {
        return c;
      }),
      n.d(t, "f", function() {
        return i;
      }),
      n.d(t, "g", function() {
        return s;
      });
    var a = n(0);
    const r = "5d7917899d8da5229c037105",
      o = new BaaS.TableObject(a.b.USER_LOTTERY_RECORD),
      u = new BaaS.TableObject(a.b.LOTTERY),
      l = new BaaS.TableObject(a.b.CONFIG),
      c = new BaaS.TableObject(a.b.ERROR);
    async function i(e) {
      let t = new BaaS.Query();
      return (
        t.compare("lottery", "=", u.getWithoutData(e)), o.setQuery(t).count()
      );
    }
    async function s() {
      let e = new BaaS.Query();
      return (
        e.compare("status", "=", 2),
        u
          .setQuery(e)
          .limit(10)
          .find()
      );
    }
  },
  ,
  ,
  ,
  ,
  ,
  function(e, t, n) {
    e.exports = n(8);
  },
  function(e, t, n) {
    "use strict";
    n.r(t),
      n.d(t, "default", function() {
        return o;
      });
    var a = n(0),
      r = n(1);
    async function o(e, t) {
      console.log(`checkLotteryStatus - event: ${e}`);
      try {
        let e = (await Object(r.g)()).data.objects;
        if (
          (console.log(`openedLotteries: ${JSON.stringify(e.map(e => e.id))}`),
          e)
        ) {
          let t = new wx.BaaS.TableObject(a.b.CONFIG),
            n = (await t.get(r.a)).data;
          for (let t in e) {
            let o = e[t],
              c = await Object(r.f)(o.id);
            console.log(`getAttendeesCount: ${c}`);
            let i =
                Math.round(Date.parse(o.open_date) / 1e3) -
                Math.round(new Date() / 1e3),
              s = new wx.BaaS.TableObject(a.b.LOTTERY);
            if (
              ((o.open_people_num = 1),
              (i = 0),
              c >= o.open_people_num && i <= 0)
            ) {
              console.log(`开奖 - lottery.id: ${o.id}`);
              let e = s.getWithoutData(o.id);
              e.set("status", 3),
                e.update(),
                l(o.open_people_num)(
                  n.plans_lottery_package[o.plan_index]
                ).filter(e => e >= 0),
                await u([0], o.id);
              l(o.open_people_num)(n.plans_lucky_package[o.plan_index]);
              await u([0], o.id, 2);
            } else o.open_people_num;
          }
        } else t(a.a.GET_LOTTERY_FAILED);
      } catch (e) {
        t(e);
      }
      t(null, "success");
    }
    const u = async (e, t, n = 1) => {
        let r = (await Promise.all(
            e.map(e => {
              let n = new wx.BaaS.Query(),
                r = new wx.BaaS.TableObject(a.b.LOTTERY);
              return (
                n.compare("lottery", "=", r.getWithoutData(t)),
                new wx.BaaS.TableObject(a.b.USER_LOTTERY_RECORD)
                  .setQuery(n)
                  .offset(e)
                  .limit(1)
                  .find()
              );
            })
          ))
            .map(e => (e.data.objects.length ? e.data.objects[0].id : null))
            .filter(e => e),
          o = new wx.BaaS.Query(),
          u = new wx.BaaS.TableObject(a.b.LOTTERY);
        o.in("id", r),
          o.compare("lottery_result", "=", 0),
          o.compare("lottery", "=", u.getWithoutData(t));
        let l = new wx.BaaS.TableObject(a.b.USER_LOTTERY_RECORD).getWithoutData(
          o
        );
        return l.set("lottery_result", n), l.update();
      },
      l = e => t => {
        let n = [];
        for (let a = 0; a < t; a++) {
          let t = Math.floor(Math.random() * e);
          n.sort((e, t) => e - t),
            n.forEach(e => {
              e <= t && (t += 1);
            }),
            n.push(t),
            e--;
        }
        return n;
      };
  }
]).default;
